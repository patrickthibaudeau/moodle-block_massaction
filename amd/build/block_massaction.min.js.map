{"version":3,"sources":["../src/block_massaction.js"],"names":["define","$","corestr","init","data","drawCheckboxes","populateMenus","on","selectAllHandler","actionHandler","courseActivities","inputControl","jQueryIdentifier","moduleId","sectionId","sectionmodules","length","children","i","document","createElement","type","id","className","body","contains","appendChild","dropMenus","menuId","menuItem","sectionnames","text","value","disabled","append","eventData","checkAll","checkNone","checkSome","moduleKey","currentTarget","val","prop","target","activities","activeTabId","courseFormat","courseformat","numberOfActivities","activeTab","textContent","activeSection","attr","split","actionTarget","action","is","push","confirmDelete","get_string","when","done","window","confirm","JSON","stringify","submit","nothingSelected","alertString","alert"],"mappings":"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","sourcesContent":["/* jshint ignore:start */\ndefine(['jquery', 'core/str'], function ($, corestr) {\n\n    return {\n        init: function (data) {\n            /*\n             * We're importing a two-dimensional array of data, including section numbers and their\n             * module/activity ids, section numbers and their human-readable labels, and the course\n             * format. The array has this structure:\n             *\n             *  [\n             *   courseformat: \"topics\",\n             *   sectionmodules: {0: [\"1\", \"2\"], 1: [\"3\"], 2: [\"4\", \"5\", \"6\"], ...},\n             *   sectionnames: [\"Main\", \"Topic 1\", \"Topic 2\", \"Topic 3\", ...]\n             *  ]\n             *\n             * The \"sectionmodules\" array will only contain sections that have modules/activities.\n             * Any sections that do not have any modules/activities will not be present in this\n             * array. Having this information makes us much less dependent upon the DOM.\n             *\n             * The \"sectionnames\" array contains the labels for all sections in the course, without\n             * regard for whether those sections have modules/activities. This is primarily used to\n             * populate the three drop menus. This is not an explicitly associative array, but the\n             * section labels are added in the order in which they display on the screen.\n             *\n             * Moodle always numbers the sections from zero to N. It's only the module id numbers that\n             * will vary. In addition, the sections and their activities are always in the order in\n             * which they appear in the browser. This is true even if the third section/topic/week/etc\n             * is moved to be in, say, the second position; its id in these arrays will change from 2 to 1,\n             * while the other section/week/topic/etc id will change from 1 to 2. The code uses sectionId\n             * to refer to the section number (display order number) and should not be confused with the\n             * section's id in the database.\n             */\n            this.data = data;\n\n            // Draw the checkboxes next to the activities.\n            this.drawCheckboxes(this.data);\n\n            // Populate the drop menus.\n            this.populateMenus(this.data);\n\n            // Assign handlers.\n            $('#block-massaction-selectall').on('click', this.data, this.selectAllHandler);\n            $('#block-massaction-selectsome').on('change', this.data, this.selectAllHandler);\n            $('#block-massaction-selectnone').on('click', this.data, this.selectAllHandler);\n\n            $('#block-massaction-outdent').on('click', this.data, this.actionHandler);\n            $('#block-massaction-indent').on('click', this.data, this.actionHandler);\n\n            $('#block-massaction-hide').on('click', this.data, this.actionHandler);\n            $('#block-massaction-show').on('click', this.data, this.actionHandler);\n\n            $('#block-massaction-delete').on('click', this.data, this.actionHandler);\n\n            $('#block-massaction-move').on('change', this.data, this.actionHandler);\n\n            $('#block-massaction-clone').on('change', this.data, this.actionHandler);\n        },\n        drawCheckboxes: function (data) {\n            let courseActivities = '';\n            let inputControl = '';\n            let jQueryIdentifier = '';\n            let moduleId = 0;\n            let sectionId = 0;\n\n            // Iterate through our sections and their activities, drawing checkboxes for each activity.\n            for (sectionId in data.sectionmodules) {\n                /*\n                 * Also check if the section exists in the DOM so we don't attempt to draw checkboxes\n                 * for activities that do not exist in the DOM.\n                 */\n                // console.log(sectionId);\n\n                if (sectionId !== null && $('#section-' + sectionId).length !== 0) {\n                    /*\n                     * We need the spans that house the edit controls in order to append our checkboxes\n                     * to them later.\n                     */\n                    jQueryIdentifier = sectionId + ' ul.section li.activity ' + 'div.mod-indent-outer div';\n                    courseActivities = $('#section-' + jQueryIdentifier).children('.actions');\n\n                    for (let i = 0; i < data.sectionmodules[sectionId].length; i++) {\n                        moduleId = data.sectionmodules[sectionId][i];\n                        inputControl = document.createElement('input');\n                        inputControl.type = 'checkbox';\n                        inputControl.id = 'massaction-input-' + moduleId;\n                        inputControl.className = 'massaction-checkbox';\n                        if (document.body.contains(courseActivities[i])) {\n                            courseActivities[i].appendChild(inputControl);\n                        }\n\n                    }\n                }\n            }\n        },\n        populateMenus: function (data) {\n            let dropMenus = ['block-massaction-selectsome',\n                'block-massaction-move',\n                'block-massaction-clone'];\n            let menuId = 0;\n            let menuItem = '';\n            let sectionId = 0;\n\n            // This loop creates and appends all the options to the three drop menus.\n            for (sectionId in data.sectionnames) {\n                for (menuId in dropMenus) {\n                    menuItem = document.createElement('option');\n                    menuItem.text = data.sectionnames[sectionId];\n                    menuItem.value = sectionId;\n\n                    /*\n                     * We are disabling menu options in the \"Select all in section\" menu for\n                     * sections that do not currently have any modules available to select.\n                     */\n                    if (dropMenus[menuId] === 'block-massaction-selectsome') {\n                        if ((sectionId in data.sectionmodules)) {\n                            menuItem.disabled = false;\n                        } else {\n                            menuItem.disabled = true;\n                        }\n                    } else {\n                        // We aren't disabling any options in the other two menus.\n                        menuItem.disabled = false;\n                    }\n\n                    $('#' + dropMenus[menuId]).append(menuItem);\n                }\n            }\n        },\n        selectAllHandler: function (eventData) {\n            // Defaults. Assume we have a bad target and plan to do nothing.\n            let checkAll = false;\n            let checkNone = false;\n            let checkSome = false;\n            let sectionId = '';\n            let moduleId = '';\n            let moduleKey = '';\n\n            /*\n             * There is no default case in this switch because it is simply unnecessary. If\n             * the value of eventData.currentTarget.id has been hacked and does not match\n             * any of the three articulated cases, then we do not want to take any action, anyway.\n             * Since that is accomplished both with and without the default case, I have opted\n             * to omit the default case.\n             */\n            switch (eventData.currentTarget.id) {\n                case 'block-massaction-selectsome':\n                    checkSome = true;\n                // Falls through.\n\n                case 'block-massaction-selectnone':\n                    checkNone = true;\n                    /*\n                     * They clicked \"Deselect all\" or \"Select all in section\", which means that if they\n                     * previously clicked \"Select all\", then they have over-ridden that choice.\n                     * Set this input's value to false to track that change.\n                     */\n                    $('#block-massaction-selected-all').val('false');\n                // Falls through.\n\n                case 'block-massaction-selectall':\n                    if (!checkNone) {\n                        checkAll = true;\n                        $('#block-massaction-selected-all').val('true');\n                    }\n\n                    // Proceed to un|check all the boxes, as appropriate.\n                    for (sectionId in eventData.data.sectionmodules) {\n                        for (moduleKey in eventData.data.sectionmodules[sectionId]) {\n                            moduleId = eventData.data.sectionmodules[sectionId][moduleKey];\n\n                            /*\n                             * Make sure this module exists in the DOM. No point setting state\n                             * on a non-existent input.\n                             */\n                            if ($('#massaction-input-' + moduleId).length > 0) {\n                                $('#massaction-input-' + moduleId).prop('checked', checkAll);\n                            }\n                        }\n                    }\n\n                    if (checkSome === true) {\n                        sectionId = eventData.target.value;\n\n                        for (moduleKey in eventData.data.sectionmodules[sectionId]) {\n                            moduleId = eventData.data.sectionmodules[sectionId][moduleKey];\n\n                            /*\n                             * Make sure this module exists in the DOM. No point setting state\n                             * on a non-existent input.\n                             */\n                            if ($('#massaction-input-' + moduleId).length > 0) {\n                                $('#massaction-input-' + moduleId).prop('checked', true);\n                            }\n                        }\n                    } else {\n                        /*\n                         * The user did not select all in a section. So we have to set this\n                         * menu's value back to 'all' in case they had previously made a menu\n                         * selection and are now clicking 'Select all' or 'Deselect all'.\n                         *\n                         * This is critical for correct operation of the block later!\n                         */\n                        $('#block-massaction-selectsome').val('all');\n                    }\n                    break;\n            }\n        },\n        actionHandler: function (eventData) {\n            let activities = new Array();\n            let activeTabId = 0;\n            let courseFormat = eventData.data.courseformat;\n            let moduleId = '';\n            let moduleKey = null;\n            let numberOfActivities = 0;\n            let sectionId = $('#block-massaction-selectsome').val();\n            let target = '';\n\n            /*\n             * When a course uses the OneTopic format and the user clicks 'Select all' or chooses\n             * an option from the \"Select all in section\" menu, then we will need to know which\n             * section was active. This enables us to determine whether they manually deselected\n             * any of the modules/activities displayed on the screen. We don't have to perform this\n             * check for any other section when the user has clicked 'Select all' because those\n             * sections' modules/activities are not present in the DOM and therefore could not be\n             * be manually deselected.\n             */\n            if (courseFormat === 'onetopic') {\n                let activeTab = $('li.active:eq(0)');\n                let textContent = activeTab[0].textContent;\n                let activeSection = $(\"li[aria-label='\" + textContent + \"']\").attr('id');\n                activeSection = activeSection.split('-');\n                activeTabId = activeSection[1];\n            }\n\n            $('#block-massaction-selected-section').val(sectionId);\n\n            // Find out what the user wants to do.\n            let actionTarget = eventData.currentTarget.id.split('-');\n            let action = actionTarget[actionTarget.length - 1];\n\n            switch (sectionId) {\n                case 'all':\n                    // The user did not select all in a section. Instead, the user\n                    // either clicked 'Select All' or manually selected modules.\n                    for (sectionId in eventData.data.sectionmodules) {\n                        for (moduleKey in eventData.data.sectionmodules[sectionId]) {\n                            moduleId = eventData.data.sectionmodules[sectionId][moduleKey];\n\n                            if (((courseFormat === 'onetopic' && activeTabId === sectionId) ||\n                                courseFormat !== 'onetopic') &&\n                                $('#massaction-input-' + moduleId).length > 0 &&\n                                $('#massaction-input-' + moduleId).is(':checked')) {\n\n                                activities.push(moduleId);\n                            } else if ($('#block-massaction-selected-all').val() === 'true' &&\n                                courseFormat === 'onetopic' && activeTabId !== sectionId) {\n                                activities.push(moduleId);\n                            }\n                        }\n                    }\n                    break;\n\n                default:\n                    // They selected all in a section.\n                    for (moduleKey in eventData.data.sectionmodules[sectionId]) {\n                        /*\n                         * Ensure the activity is actually checked because it is possible they selected\n                         * all in a section, then changed their minds and manually deselected one or more.\n                         * Assuming they are all checked in the selected section would mean that, in such\n                         * a situation, the user would have to manually change ther selection in the drop\n                         * menu, as well.\n                         */\n                        moduleId = eventData.data.sectionmodules[sectionId][moduleKey];\n\n                        if (((courseFormat === 'onetopic' && activeTabId === sectionId) ||\n                            courseFormat !== 'onetopic') &&\n                            $('#massaction-input-' + moduleId).length > 0 &&\n                            $('#massaction-input-' + moduleId).is(':checked')) {\n\n                            activities.push(moduleId);\n                        } else if (courseFormat === 'onetopic' && activeTabId !== sectionId) {\n                            activities.push(moduleId);\n                        }\n                    }\n            }\n\n            numberOfActivities = activities.length;\n\n            /*\n             * The default case for this switch has been omitted because if the value of action\n             * is not one of the three enumerated in the switch, then there is nothing special\n             * we need to do.\n             */\n            switch (action) {\n                case 'delete':\n                    if (numberOfActivities > 0) {\n                        let confirmDelete = corestr.get_string('confirmation',\n                            'block_massaction',\n                            numberOfActivities);\n\n                        $.when(confirmDelete).done(function (confirmDelete) {\n                            if (!window.confirm(confirmDelete)) {\n                                return false;\n                            } else {\n                                return true;\n                            }\n                        });\n                    }\n                    break;\n\n                case 'move':\n                case 'clone':\n                    target = $('#block-massaction-' + action).val();\n                    break;\n            }\n\n            $('#block-massaction-action').val(action);\n            $('#block-massaction-activities').val(JSON.stringify(activities));\n            $('#block-massaction-target').val(target);\n\n            if (numberOfActivities > 0) {\n                $('#block-massaction-control-form').submit();\n            } else {\n                let nothingSelected = corestr.get_string('noitemselected', 'block_massaction');\n                $.when(nothingSelected).done(function (alertString) {\n                    window.alert(alertString);\n                });\n            }\n        }\n    }\n})\n"],"file":"block_massaction.min.js"}